/**
 * @fileoverview added by tsickle
 * Generated from: lib/senwes-authorization.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, isDevMode } from '@angular/core';
import { JwtHelperService } from '@auth0/angular-jwt';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { take } from 'rxjs/operators';
import { senwes_dev_token } from './senwes_token_dev';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
var SenwesAuthorizationService = /** @class */ (function () {
    function SenwesAuthorizationService(_http) {
        this._http = _http;
        this.base_url = window.location.origin;
        this.appId = '';
        this.jwtHelper = new JwtHelperService();
    }
    /**
     * Retrieves raw token from local storage
     */
    /**
     * Retrieves raw token from local storage
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getToken = /**
     * Retrieves raw token from local storage
     * @return {?}
     */
    function () {
        if (isDevMode()) {
            return localStorage.getItem("senwes_token_dev");
        }
        return localStorage.getItem("senwes_token");
    };
    /**
     * Retrieves decoded token from local storage
     */
    /**
     * Retrieves decoded token from local storage
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getDecodedToken = /**
     * Retrieves decoded token from local storage
     * @return {?}
     */
    function () {
        if (isDevMode()) {
            return this.jwtHelper.decodeToken(localStorage.getItem("senwes_token_dev"));
        }
        return this.jwtHelper.decodeToken(localStorage.getItem("senwes_token"));
    };
    /**
     * Confirms validity of token
     */
    /**
     * Confirms validity of token
     * @param {?} appId
     * @param {?=} customDevToken
     * @return {?}
     */
    SenwesAuthorizationService.prototype.authenticateToken = /**
     * Confirms validity of token
     * @param {?} appId
     * @param {?=} customDevToken
     * @return {?}
     */
    function (appId, customDevToken) {
        if (customDevToken === void 0) { customDevToken = null; }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                return [2 /*return*/, new Promise((/**
                     * @param {?} resolve
                     * @param {?} reject
                     * @return {?}
                     */
                    function (resolve, reject) {
                        if (isDevMode()) {
                            localStorage.removeItem('senwes_token_dev');
                            if (customDevToken != null) {
                                localStorage.setItem('senwes_token_dev', customDevToken);
                            }
                            else {
                                localStorage.setItem('senwes_token_dev', senwes_dev_token);
                            }
                            resolve(true);
                            _this.initializeUser();
                        }
                        else {
                            _this.appId = appId;
                            /** @type {?} */
                            var url = '';
                            if (_this.base_url.indexOf("online-qa.senwes.co.za") > -1 || _this.base_url.indexOf("online-qa.hinterland.co.za") > -1 || _this.base_url.indexOf("online-qa.my-intranet.co.za") > -1) {
                                url = "https://wsstaging.senwes.co.za/api/oneagri/security/api/Authentication/Validate/Token";
                            }
                            else {
                                url = "https://ws.senwes.co.za/service/oneagri/security/api/Authentication/Validate/Token";
                            }
                            /** @type {?} */
                            var headers = new HttpHeaders({
                                'Content-Type': 'application/json',
                                'Authorization': "Bearer " + _this.getLocalToken()
                            });
                            _this._http.get(url, { headers: headers })
                                .pipe(take(1))
                                .subscribe((/**
                             * @param {?} res
                             * @return {?}
                             */
                            function (res) {
                                if (res === false) {
                                    localStorage.removeItem('senwes_token');
                                    _this.redirectJWTIssuerPage(appId);
                                    resolve(false);
                                }
                                else if (res === true) {
                                    resolve(true);
                                    _this.initializeUser();
                                }
                                else {
                                    resolve(false);
                                    console.error('Unxpected response validate token: ', res);
                                    _this.redirectAccessDenied();
                                }
                            }), (/**
                             * @param {?} error
                             * @return {?}
                             */
                            function (error) {
                                reject(false);
                                console.error("AuthService unexpected error occurred", error);
                                _this.redirectAccessDenied();
                            }));
                        }
                    }))];
            });
        });
    };
    /**
     * @private
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getLocalToken = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var token = '';
        if (isDevMode()) {
            token = localStorage.getItem("senwes_token_dev");
        }
        else {
            token = localStorage.getItem("senwes_token");
        }
        return token;
    };
    /**
     * @private
     * @param {?} returnURL
     * @return {?}
     */
    SenwesAuthorizationService.prototype.redirectJWTIssuerPage = /**
     * @private
     * @param {?} returnURL
     * @return {?}
     */
    function (returnURL) {
        if (this.base_url.indexOf("online-qa.senwes.co.za") > -1 || this.base_url.indexOf("online-qa.hinterland.co.za") > -1 || this.base_url.indexOf("online-qa.my-intranet.co.za") > -1) {
            window.location.href = "https://integration-qa.senwes.co.za/service/security/oneagri/auth/authentication?ApplicationID=" + this.appId;
        }
        else {
            window.location.href = "https://identity.oneagri.co.za/authentication?ApplicationID=" + this.appId;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.signout = /**
     * @return {?}
     */
    function () {
        localStorage.removeItem('senwes_token');
        localStorage.removeItem('senwes_token_dev');
        if (isDevMode()) {
            window.location.reload;
        }
        else {
            if (this.base_url.indexOf("online-qa.senwes.co.za") > -1 || this.base_url.indexOf("online-qa.hinterland.co.za") > -1 || this.base_url.indexOf("online-qa.my-intranet.co.za") > -1) {
                window.location.href = "https://integration-qa.senwes.co.za/service/security/oneagri/auth/signout";
            }
            else {
                window.location.href = "https://identity.oneagri.co.za/signout";
            }
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.home = /**
     * @return {?}
     */
    function () {
        if (isDevMode()) {
            window.location.reload;
        }
        else {
            window.location.href = this.base_url;
        }
    };
    /**
     * @private
     * @return {?}
     */
    SenwesAuthorizationService.prototype.redirectAccessDenied = /**
     * @private
     * @return {?}
     */
    function () {
        window.location.href = "http://www.oneagri.co.za/auth/accessdenied/";
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserRoles = /**
     * @return {?}
     */
    function () {
        if (this._user) {
            return this._user.role;
        }
    };
    /**
     * @param {?} roleName
     * @return {?}
     */
    SenwesAuthorizationService.prototype.isUserInRole = /**
     * @param {?} roleName
     * @return {?}
     */
    function (roleName) {
        if (this._user) {
            if (Array.isArray(this._user.role)) {
                /** @type {?} */
                var res = this._user.role.findIndex((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return x == roleName; }));
                return (res !== -1);
            }
            else {
                return (roleName === this._user.role);
            }
        }
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserPermissionsBySystemName = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        if (this._user) {
            if (Array.isArray(this._user.permissions)) {
                /** @type {?} */
                var res = this._user.permissions.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return x.SystemName == filter; }));
                return res;
            }
        }
    };
    /**
     * @param {?} permissionGroup
     * @param {?} permissionName
     * @return {?}
     */
    SenwesAuthorizationService.prototype.hasPermission = /**
     * @param {?} permissionGroup
     * @param {?} permissionName
     * @return {?}
     */
    function (permissionGroup, permissionName) {
        if (this._user) {
            if (Array.isArray(this._user.permissions)) {
                /** @type {?} */
                var res = this._user.permissions.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return x.PermissionGroup == permissionGroup && x.PermissionName == permissionName; }));
                return res.length > 0;
            }
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getRawUserObject = /**
     * @return {?}
     */
    function () {
        return this._user;
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserWindowsClaim = /**
     * @return {?}
     */
    function () {
        if (this._user) {
            return this._user.windowsuserclaim;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserCompany = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.company;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserDivision = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.division;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserSection = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.section;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserJobTitle = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.jobtitle;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserEmpObfuscation = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.employeeobfuscation;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserSite = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.site;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserReportsTo = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.reportsTo;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserDepartment = /**
     * @return {?}
     */
    function () {
        if (this._user.employee) {
            return this._user.employee.department;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserEmployeeNumber = /**
     * @return {?}
     */
    function () {
        if (this._user) {
            return this._user.employeeNo;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserOneId = /**
     * @return {?}
     */
    function () {
        if (this._user) {
            return this._user.oneid;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserDisplayName = /**
     * @return {?}
     */
    function () {
        if (this._user) {
            return this._user.given_name + " " + this._user.family_name;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getUserEmployeeInfo = /**
     * @return {?}
     */
    function () {
        if (this._user) {
            return this._user.employee;
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.getTokenExpired = /**
     * @return {?}
     */
    function () {
        this._user = this.jwtHelper.decodeToken(this.getToken());
        if (this._user) {
            return this._user.exp < Math.floor(Date.now() / 1000);
        }
    };
    /**
     * @return {?}
     */
    SenwesAuthorizationService.prototype.initializeUser = /**
     * @return {?}
     */
    function () {
        this._user = this.jwtHelper.decodeToken(this.getToken());
        if (typeof this._user.role !== 'undefined' && !Array.isArray(this._user.role)) {
            this._user.role = [this._user.role];
        }
        if (typeof this._user.permissions !== 'undefined' && !Array.isArray(this._user.permissions)) {
            this._user.permissions = [this._user.permissions];
        }
    };
    SenwesAuthorizationService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root',
                },] }
    ];
    /** @nocollapse */
    SenwesAuthorizationService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ SenwesAuthorizationService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function SenwesAuthorizationService_Factory() { return new SenwesAuthorizationService(i0.ɵɵinject(i1.HttpClient)); }, token: SenwesAuthorizationService, providedIn: "root" });
    return SenwesAuthorizationService;
}());
export { SenwesAuthorizationService };
if (false) {
    /** @type {?} */
    SenwesAuthorizationService.prototype.base_url;
    /** @type {?} */
    SenwesAuthorizationService.prototype.appId;
    /**
     * @type {?}
     * @private
     */
    SenwesAuthorizationService.prototype._user;
    /** @type {?} */
    SenwesAuthorizationService.prototype.jwtHelper;
    /**
     * @type {?}
     * @private
     */
    SenwesAuthorizationService.prototype._http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Vud2VzLWF1dGhvcml6YXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzZW53ZXMvc2Vud2VzLWF1dGhvcml6YXRpb24vIiwic291cmNlcyI6WyJsaWIvc2Vud2VzLWF1dGhvcml6YXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0RCxPQUFPLEVBQWEsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRS9ELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7O0FBSXREO0lBVUUsb0NBQ1UsS0FBaUI7UUFBakIsVUFBSyxHQUFMLEtBQUssQ0FBWTtRQVBwQixhQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDbEMsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUduQixjQUFTLEdBQUcsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO0lBSXRDLENBQUM7SUFFTDs7T0FFRzs7Ozs7SUFDSSw2Q0FBUTs7OztJQUFmO1FBQ0UsSUFBSSxTQUFTLEVBQUUsRUFBRTtZQUNmLE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQ2pEO1FBQ0QsT0FBTyxZQUFZLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRDs7T0FFRzs7Ozs7SUFDSSxvREFBZTs7OztJQUF0QjtRQUNFLElBQUksU0FBUyxFQUFFLEVBQUU7WUFDakIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FB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LEtBQUssQ0FBQyxJQUFJLEtBQUssV0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzdFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNyQztRQUVELElBQUksT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsS0FBSyxXQUFXLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEVBQUU7WUFDM0YsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ25EO0lBQ0gsQ0FBQzs7Z0JBM1FGLFVBQVUsU0FBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7Ozs7Z0JBVFEsVUFBVTs7O3FDQUZuQjtDQXFSQyxBQTVRRCxJQTRRQztTQXpRWSwwQkFBMEI7OztJQUNyQyw4Q0FBeUM7O0lBQ3pDLDJDQUEwQjs7Ozs7SUFDMUIsMkNBQXFCOztJQUVyQiwrQ0FBMEM7Ozs7O0lBR3hDLDJDQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIGlzRGV2TW9kZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBKd3RNb2R1bGUsIEp3dEhlbHBlclNlcnZpY2UgfSBmcm9tICdAYXV0aDAvYW5ndWxhci1qd3QnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgSVVzZXIgfSBmcm9tICcuL3VzZXIubW9kZWwnO1xyXG5pbXBvcnQgeyB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBzZW53ZXNfZGV2X3Rva2VuIH0gZnJvbSAnLi9zZW53ZXNfdG9rZW5fZGV2JztcclxuaW1wb3J0IHsgSUVtcGxveWVlIH0gZnJvbSAnLi9lbXBsb3llZS5tb2RlbCc7XHJcbmltcG9ydCB7IElQZXJtaXNzaW9uIH0gZnJvbSAnLi9wZXJtaXNzaW9uLm1vZGVsJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTZW53ZXNBdXRob3JpemF0aW9uU2VydmljZSB7XHJcbiAgcHVibGljIGJhc2VfdXJsID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjtcclxuICBwdWJsaWMgYXBwSWQ6IHN0cmluZyA9ICcnO1xyXG4gIHByaXZhdGUgX3VzZXI6IElVc2VyO1xyXG5cclxuICBwdWJsaWMgand0SGVscGVyID0gbmV3IEp3dEhlbHBlclNlcnZpY2UoKTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9odHRwOiBIdHRwQ2xpZW50LFxyXG4gICkgeyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHJpZXZlcyByYXcgdG9rZW4gZnJvbSBsb2NhbCBzdG9yYWdlXHJcbiAgICovXHJcbiAgcHVibGljIGdldFRva2VuKCk6IHN0cmluZyB7XHJcbiAgICBpZiAoaXNEZXZNb2RlKCkpIHtcclxuICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic2Vud2VzX3Rva2VuX2RldlwiKTtcclxuICAgIH1cclxuICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInNlbndlc190b2tlblwiKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHJpZXZlcyBkZWNvZGVkIHRva2VuIGZyb20gbG9jYWwgc3RvcmFnZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXREZWNvZGVkVG9rZW4oKTogYW55IHtcclxuICAgIGlmIChpc0Rldk1vZGUoKSkge1xyXG4gICAgcmV0dXJuIHRoaXMuand0SGVscGVyLmRlY29kZVRva2VuKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic2Vud2VzX3Rva2VuX2RldlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5qd3RIZWxwZXIuZGVjb2RlVG9rZW4obG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzZW53ZXNfdG9rZW5cIikpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29uZmlybXMgdmFsaWRpdHkgb2YgdG9rZW5cclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgYXV0aGVudGljYXRlVG9rZW4oYXBwSWQ6IHN0cmluZywgY3VzdG9tRGV2VG9rZW46IHN0cmluZyA9IG51bGwpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xyXG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3Nlbndlc190b2tlbl9kZXYnKTtcclxuXHJcbiAgICAgICAgICBpZiAoY3VzdG9tRGV2VG9rZW4gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2Vud2VzX3Rva2VuX2RldicsIGN1c3RvbURldlRva2VuKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzZW53ZXNfdG9rZW5fZGV2Jywgc2Vud2VzX2Rldl90b2tlbik7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZVVzZXIoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5hcHBJZCA9IGFwcElkO1xyXG4gICAgICAgICAgbGV0IHVybCA9ICcnO1xyXG4gICAgICAgICAgaWYgKHRoaXMuYmFzZV91cmwuaW5kZXhPZihcIm9ubGluZS1xYS5zZW53ZXMuY28uemFcIikgPiAtMSB8fCB0aGlzLmJhc2VfdXJsLmluZGV4T2YoXCJvbmxpbmUtcWEuaGludGVybGFuZC5jby56YVwiKSA+IC0xIHx8IHRoaXMuYmFzZV91cmwuaW5kZXhPZihcIm9ubGluZS1xYS5teS1pbnRyYW5ldC5jby56YVwiKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHVybCA9IGBodHRwczovL3dzc3RhZ2luZy5zZW53ZXMuY28uemEvYXBpL29uZWFncmkvc2VjdXJpdHkvYXBpL0F1dGhlbnRpY2F0aW9uL1ZhbGlkYXRlL1Rva2VuYDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHVybCA9IGBodHRwczovL3dzLnNlbndlcy5jby56YS9zZXJ2aWNlL29uZWFncmkvc2VjdXJpdHkvYXBpL0F1dGhlbnRpY2F0aW9uL1ZhbGlkYXRlL1Rva2VuYDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKHtcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5nZXRMb2NhbFRva2VuKCl9YFxyXG4gICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICB0aGlzLl9odHRwLmdldDxib29sZWFuPih1cmwsIHsgaGVhZGVyczogaGVhZGVycyB9KVxyXG4gICAgICAgICAgICAucGlwZSh0YWtlKDEpKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgIChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3Nlbndlc190b2tlbicpO1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnJlZGlyZWN0SldUSXNzdWVyUGFnZShhcHBJZCk7XHJcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplVXNlcigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VueHBlY3RlZCByZXNwb25zZSB2YWxpZGF0ZSB0b2tlbjogJywgcmVzKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5yZWRpcmVjdEFjY2Vzc0RlbmllZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdXRoU2VydmljZSB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkXCIsIGVycm9yKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVkaXJlY3RBY2Nlc3NEZW5pZWQoKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TG9jYWxUb2tlbigpOiBzdHJpbmcge1xyXG4gICAgbGV0IHRva2VuID0gJyc7XHJcbiAgICBpZiAoaXNEZXZNb2RlKCkpIHtcclxuICAgICAgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInNlbndlc190b2tlbl9kZXZcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic2Vud2VzX3Rva2VuXCIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRva2VuO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWRpcmVjdEpXVElzc3VlclBhZ2UocmV0dXJuVVJMOiBzdHJpbmcpIHtcclxuICAgIGlmICh0aGlzLmJhc2VfdXJsLmluZGV4T2YoXCJvbmxpbmUtcWEuc2Vud2VzLmNvLnphXCIpID4gLTEgfHwgdGhpcy5iYXNlX3VybC5pbmRleE9mKFwib25saW5lLXFhLmhpbnRlcmxhbmQuY28uemFcIikgPiAtMSB8fCB0aGlzLmJhc2VfdXJsLmluZGV4T2YoXCJvbmxpbmUtcWEubXktaW50cmFuZXQuY28uemFcIikgPiAtMSkge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGBodHRwczovL2ludGVncmF0aW9uLXFhLnNlbndlcy5jby56YS9zZXJ2aWNlL3NlY3VyaXR5L29uZWFncmkvYXV0aC9hdXRoZW50aWNhdGlvbj9BcHBsaWNhdGlvbklEPSR7dGhpcy5hcHBJZH1gO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgaHR0cHM6Ly9pZGVudGl0eS5vbmVhZ3JpLmNvLnphL2F1dGhlbnRpY2F0aW9uP0FwcGxpY2F0aW9uSUQ9JHt0aGlzLmFwcElkfWA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2lnbm91dCgpIHtcclxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdzZW53ZXNfdG9rZW4nKTtcclxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdzZW53ZXNfdG9rZW5fZGV2Jyk7XHJcbiAgICBpZiAoaXNEZXZNb2RlKCkpIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh0aGlzLmJhc2VfdXJsLmluZGV4T2YoXCJvbmxpbmUtcWEuc2Vud2VzLmNvLnphXCIpID4gLTEgfHwgdGhpcy5iYXNlX3VybC5pbmRleE9mKFwib25saW5lLXFhLmhpbnRlcmxhbmQuY28uemFcIikgPiAtMSB8fCB0aGlzLmJhc2VfdXJsLmluZGV4T2YoXCJvbmxpbmUtcWEubXktaW50cmFuZXQuY28uemFcIikgPiAtMSkge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYGh0dHBzOi8vaW50ZWdyYXRpb24tcWEuc2Vud2VzLmNvLnphL3NlcnZpY2Uvc2VjdXJpdHkvb25lYWdyaS9hdXRoL3NpZ25vdXRgO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYGh0dHBzOi8vaWRlbnRpdHkub25lYWdyaS5jby56YS9zaWdub3V0YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGhvbWUoKSB7XHJcbiAgICBpZiAoaXNEZXZNb2RlKCkpIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdGhpcy5iYXNlX3VybDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVkaXJlY3RBY2Nlc3NEZW5pZWQoKSB7XHJcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGBodHRwOi8vd3d3Lm9uZWFncmkuY28uemEvYXV0aC9hY2Nlc3NkZW5pZWQvYDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyUm9sZXMoKTogQXJyYXk8c3RyaW5nPiB7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5yb2xlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzVXNlckluUm9sZShyb2xlTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLl91c2VyLnJvbGUpKSB7XHJcbiAgICAgICAgY29uc3QgcmVzID0gdGhpcy5fdXNlci5yb2xlLmZpbmRJbmRleCh4ID0+IHggPT0gcm9sZU5hbWUpO1xyXG4gICAgICAgIHJldHVybiAocmVzICE9PSAtMSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIChyb2xlTmFtZSA9PT0gdGhpcy5fdXNlci5yb2xlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJQZXJtaXNzaW9uc0J5U3lzdGVtTmFtZShmaWx0ZXI6IHN0cmluZyk6IElQZXJtaXNzaW9uW10ge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIpIHtcclxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5fdXNlci5wZXJtaXNzaW9ucykpIHtcclxuICAgICAgICBjb25zdCByZXMgPSB0aGlzLl91c2VyLnBlcm1pc3Npb25zLmZpbHRlcih4ID0+IHguU3lzdGVtTmFtZSA9PSBmaWx0ZXIpO1xyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBoYXNQZXJtaXNzaW9uKHBlcm1pc3Npb25Hcm91cDogc3RyaW5nLCBwZXJtaXNzaW9uTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLl91c2VyLnBlcm1pc3Npb25zKSkge1xyXG4gICAgICAgIGNvbnN0IHJlcyA9IHRoaXMuX3VzZXIucGVybWlzc2lvbnMuZmlsdGVyKHggPT4geC5QZXJtaXNzaW9uR3JvdXAgPT0gcGVybWlzc2lvbkdyb3VwICYmIHguUGVybWlzc2lvbk5hbWUgPT0gcGVybWlzc2lvbk5hbWUpO1xyXG4gICAgICAgIHJldHVybiByZXMubGVuZ3RoID4gMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFJhd1VzZXJPYmplY3QoKTogSVVzZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX3VzZXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlcldpbmRvd3NDbGFpbSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIud2luZG93c3VzZXJjbGFpbTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyQ29tcGFueSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIuZW1wbG95ZWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIuZW1wbG95ZWUuY29tcGFueTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyRGl2aXNpb24oKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyLmVtcGxveWVlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLmVtcGxveWVlLmRpdmlzaW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJTZWN0aW9uKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlci5lbXBsb3llZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5lbXBsb3llZS5zZWN0aW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJKb2JUaXRsZSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIuZW1wbG95ZWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIuZW1wbG95ZWUuam9idGl0bGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlckVtcE9iZnVzY2F0aW9uKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlci5lbXBsb3llZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5lbXBsb3llZS5lbXBsb3llZW9iZnVzY2F0aW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJTaXRlKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlci5lbXBsb3llZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5lbXBsb3llZS5zaXRlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJSZXBvcnRzVG8oKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyLmVtcGxveWVlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLmVtcGxveWVlLnJlcG9ydHNUbztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyRGVwYXJ0bWVudCgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIuZW1wbG95ZWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIuZW1wbG95ZWUuZGVwYXJ0bWVudDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyRW1wbG95ZWVOdW1iZXIoKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLmVtcGxveWVlTm87XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlck9uZUlkKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5vbmVpZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyRGlzcGxheU5hbWUoKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyKSB7XHJcbiAgICAgIHJldHVybiBgJHt0aGlzLl91c2VyLmdpdmVuX25hbWV9ICR7dGhpcy5fdXNlci5mYW1pbHlfbmFtZX1gXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlckVtcGxveWVlSW5mbygpOiBJRW1wbG95ZWUge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIuZW1wbG95ZWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VG9rZW5FeHBpcmVkKCk6IGJvb2xlYW4ge1xyXG4gICAgdGhpcy5fdXNlciA9IHRoaXMuand0SGVscGVyLmRlY29kZVRva2VuKHRoaXMuZ2V0VG9rZW4oKSk7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5leHAgPCBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBpbml0aWFsaXplVXNlcigpOiB2b2lkIHtcclxuICAgIHRoaXMuX3VzZXIgPSB0aGlzLmp3dEhlbHBlci5kZWNvZGVUb2tlbih0aGlzLmdldFRva2VuKCkpO1xyXG4gICAgaWYgKHR5cGVvZiB0aGlzLl91c2VyLnJvbGUgIT09ICd1bmRlZmluZWQnICYmICFBcnJheS5pc0FycmF5KHRoaXMuX3VzZXIucm9sZSkpIHtcclxuICAgICAgdGhpcy5fdXNlci5yb2xlID0gW3RoaXMuX3VzZXIucm9sZV07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiB0aGlzLl91c2VyLnBlcm1pc3Npb25zICE9PSAndW5kZWZpbmVkJyAmJiAhQXJyYXkuaXNBcnJheSh0aGlzLl91c2VyLnBlcm1pc3Npb25zKSkge1xyXG4gICAgICB0aGlzLl91c2VyLnBlcm1pc3Npb25zID0gW3RoaXMuX3VzZXIucGVybWlzc2lvbnNdO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=