{"version":3,"file":"senwes-senwes-authorization.js","sources":["@senwes/senwes-authorization/lib/senwes_token_dev.ts","@senwes/senwes-authorization/lib/senwes-authorization.service.ts"],"names":[],"mappings":"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","sourcesContent":["export const senwes_dev_token = `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IjA0NSIsIm5hbWVpZCI6IjA0NSIsImVtYWlsIjoiTXVoYW1tYWQuQW1vZEBzZW53ZXMuY28uemEiLCJnaXZlbl9uYW1lIjoiTXVoYW1tYWQiLCJmYW1pbHlfbmFtZSI6IkFtb2QiLCJvbmVpZCI6IjA0NSIsImVtcGxveWVlTm8iOiIxMDg5MSIsInJvbGUiOlsiRG9jdW1lbnRNYW5hZ2VtZW50X1N1cGVyVXNlciJdLCJ3aW5kb3dzdXNlcmNsYWltIjoibXVoYW1tYWRhIiwibmJmIjoxNTk3OTg4NTQwLCJleHAiOjE5MjIzOTk5OTksImlhdCI6MTU5Nzk4ODU0MCwiaXNzIjoiU2Vud2VzIEF1dGggU2VydmljZSIsImF1ZCI6IlNlbndlcyBBcHBsaWNhdGlvbiBVc2VycyJ9.krMb-5byqnJ1LwJpNv688mtGo4n6146h7_sKzHFiGx0`;","import { Injectable, isDevMode } from '@angular/core';\r\nimport { JwtModule, JwtHelperService } from '@auth0/angular-jwt';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { IUser } from './user.model';\r\nimport { take } from 'rxjs/operators';\r\nimport { senwes_dev_token } from './senwes_token_dev';\r\nimport { IEmployee } from './employee.model';\r\nimport { IPermission } from './permission.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class SenwesAuthorizationService {\r\n  public base_url = window.location.origin;\r\n  public appId: string = '';\r\n  private _user: IUser;\r\n\r\n  public jwtHelper = new JwtHelperService();\r\n\r\n  constructor(\r\n    private _http: HttpClient,\r\n  ) { }\r\n\r\n  /**\r\n   * Retrieves raw token from local storage\r\n   */\r\n  public getToken(): string {\r\n    if (isDevMode()) {\r\n      return localStorage.getItem(\"senwes_token_dev\");\r\n    }\r\n    return localStorage.getItem(\"senwes_token\");\r\n  }\r\n\r\n  /**\r\n   * Retrieves decoded token from local storage\r\n   */\r\n  public getDecodedToken(): any {\r\n    if (isDevMode()) {\r\n    return this.jwtHelper.decodeToken(localStorage.getItem(\"senwes_token_dev\"));\r\n    }\r\n    return this.jwtHelper.decodeToken(localStorage.getItem(\"senwes_token\"));\r\n  }\r\n\r\n  /**\r\n   * Confirms validity of token\r\n   */\r\n  public async authenticateToken(appId: string, customDevToken: string = null): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      if (isDevMode()) {\r\n          localStorage.removeItem('senwes_token_dev');\r\n\r\n          if (customDevToken != null) {\r\n            localStorage.setItem('senwes_token_dev', customDevToken);\r\n          } else {\r\n            localStorage.setItem('senwes_token_dev', senwes_dev_token);\r\n          }\r\n\r\n          resolve(true);\r\n          this.initializeUser();\r\n        } else {\r\n          this.appId = appId;\r\n          let url = '';\r\n          if (this.base_url.indexOf(\"online-qa.senwes.co.za\") > -1 || this.base_url.indexOf(\"online-qa.hinterland.co.za\") > -1 || this.base_url.indexOf(\"online-qa.my-intranet.co.za\") > -1) {\r\n            url = `https://wsstaging.senwes.co.za/api/oneagri/security/api/Authentication/Validate/Token`;\r\n          } else {\r\n            url = `https://ws.senwes.co.za/service/oneagri/security/api/Authentication/Validate/Token`;\r\n          }\r\n\r\n          const headers = new HttpHeaders({\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${this.getLocalToken()}`\r\n          })\r\n\r\n          this._http.get<boolean>(url, { headers: headers })\r\n            .pipe(take(1))\r\n            .subscribe(\r\n              (res: any) => {\r\n                if (res === false) {\r\n                  localStorage.removeItem('senwes_token');\r\n                  this.redirectJWTIssuerPage(appId);\r\n                  resolve(false);\r\n                } else if (res === true) {\r\n                  resolve(true);\r\n                  this.initializeUser();\r\n                } else {\r\n                  resolve(false);\r\n                  console.error('Unxpected response validate token: ', res);\r\n                  this.redirectAccessDenied();\r\n                }\r\n              },\r\n              error => {\r\n                reject(false);\r\n                console.error(\"AuthService unexpected error occurred\", error);\r\n                this.redirectAccessDenied();\r\n              });\r\n        }\r\n    });\r\n  }\r\n\r\n  private getLocalToken(): string {\r\n    let token = '';\r\n    if (isDevMode()) {\r\n      token = localStorage.getItem(\"senwes_token_dev\");\r\n    } else {\r\n      token = localStorage.getItem(\"senwes_token\");\r\n    }\r\n    return token;\r\n  }\r\n\r\n  private redirectJWTIssuerPage(returnURL: string) {\r\n    if (this.base_url.indexOf(\"online-qa.senwes.co.za\") > -1 || this.base_url.indexOf(\"online-qa.hinterland.co.za\") > -1 || this.base_url.indexOf(\"online-qa.my-intranet.co.za\") > -1) {\r\n      window.location.href = `https://integration-qa.senwes.co.za/service/security/oneagri/auth/authentication?ApplicationID=${this.appId}`;\r\n    } else {\r\n      window.location.href = `https://identity.oneagri.co.za/authentication?ApplicationID=${this.appId}`;\r\n    }\r\n  }\r\n\r\n  public signout() {\r\n    localStorage.removeItem('senwes_token');\r\n    localStorage.removeItem('senwes_token_dev');\r\n    if (isDevMode()) {\r\n      window.location.reload;\r\n    } else {\r\n      if (this.base_url.indexOf(\"online-qa.senwes.co.za\") > -1 || this.base_url.indexOf(\"online-qa.hinterland.co.za\") > -1 || this.base_url.indexOf(\"online-qa.my-intranet.co.za\") > -1) {\r\n        window.location.href = `https://integration-qa.senwes.co.za/service/security/oneagri/auth/signout`;\r\n      } else {\r\n        window.location.href = `https://identity.oneagri.co.za/signout`;\r\n      }\r\n    }\r\n  }\r\n\r\n  public home() {\r\n    if (isDevMode()) {\r\n      window.location.reload;\r\n    } else {\r\n      window.location.href = this.base_url;\r\n    }\r\n  }\r\n\r\n  private redirectAccessDenied() {\r\n    window.location.href = `http://www.oneagri.co.za/auth/accessdenied/`;\r\n  }\r\n\r\n  public getUserRoles(): Array<string> {\r\n    if (this._user) {\r\n      return this._user.role;\r\n    }\r\n  }\r\n\r\n  public isUserInRole(roleName: string): boolean {\r\n    if (this._user) {\r\n      if (Array.isArray(this._user.role)) {\r\n        const res = this._user.role.findIndex(x => x == roleName);\r\n        return (res !== -1);\r\n      } else {\r\n        return (roleName === this._user.role);\r\n      }\r\n    }\r\n  }\r\n\r\n  public getUserPermissionsBySystemName(filter: string): IPermission[] {\r\n    if (this._user) {\r\n      if (Array.isArray(this._user.permissions)) {\r\n        const res = this._user.permissions.filter(x => x.SystemName == filter);\r\n        return res;\r\n      }\r\n    }\r\n  }\r\n\r\n  public hasPermission(permissionGroup: string, permissionName: string): boolean {\r\n    if (this._user) {\r\n      if (Array.isArray(this._user.permissions)) {\r\n        const res = this._user.permissions.filter(x => x.PermissionGroup == permissionGroup && x.PermissionName == permissionName);\r\n        return res.length > 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getRawUserObject(): IUser {\r\n    return this._user;\r\n  }\r\n\r\n  public getUserWindowsClaim(): string {\r\n    if (this._user) {\r\n      return this._user.windowsuserclaim;\r\n    }\r\n  }\r\n\r\n  public getUserCompany(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.company;\r\n    }\r\n  }\r\n\r\n  public getUserDivision(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.division;\r\n    }\r\n  }\r\n\r\n  public getUserSection(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.section;\r\n    }\r\n  }\r\n\r\n  public getUserJobTitle(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.jobtitle;\r\n    }\r\n  }\r\n\r\n  public getUserEmpObfuscation(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.employeeobfuscation;\r\n    }\r\n  }\r\n\r\n  public getUserSite(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.site;\r\n    }\r\n  }\r\n\r\n  public getUserReportsTo(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.reportsTo;\r\n    }\r\n  }\r\n\r\n  public getUserDepartment(): string {\r\n    if (this._user.employee) {\r\n      return this._user.employee.department;\r\n    }\r\n  }\r\n\r\n  public getUserEmployeeNumber(): string {\r\n    if (this._user) {\r\n      return this._user.employeeNo;\r\n    }\r\n  }\r\n\r\n  public getUserOneId(): string {\r\n    if (this._user) {\r\n      return this._user.oneid;\r\n    }\r\n  }\r\n\r\n  public getUserDisplayName(): string {\r\n    if (this._user) {\r\n      return `${this._user.given_name} ${this._user.family_name}`\r\n    }\r\n  }\r\n\r\n  public getUserEmployeeInfo(): IEmployee {\r\n    if (this._user) {\r\n      return this._user.employee;\r\n    }\r\n  }\r\n\r\n  public getTokenExpired(): boolean {\r\n    this._user = this.jwtHelper.decodeToken(this.getToken());\r\n    if (this._user) {\r\n      return this._user.exp < Math.floor(Date.now() / 1000);\r\n    }\r\n  }\r\n\r\n  public initializeUser(): void {\r\n    this._user = this.jwtHelper.decodeToken(this.getToken());\r\n    if (typeof this._user.role !== 'undefined' && !Array.isArray(this._user.role)) {\r\n      this._user.role = [this._user.role];\r\n    }\r\n\r\n    if (typeof this._user.permissions !== 'undefined' && !Array.isArray(this._user.permissions)) {\r\n      this._user.permissions = [this._user.permissions];\r\n    }\r\n  }\r\n}\r\n"]}