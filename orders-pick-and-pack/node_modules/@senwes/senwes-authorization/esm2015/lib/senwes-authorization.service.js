/**
 * @fileoverview added by tsickle
 * Generated from: lib/senwes-authorization.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, isDevMode } from '@angular/core';
import { JwtHelperService } from '@auth0/angular-jwt';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { take } from 'rxjs/operators';
import { senwes_dev_token } from './senwes_token_dev';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class SenwesAuthorizationService {
    /**
     * @param {?} _http
     */
    constructor(_http) {
        this._http = _http;
        this.base_url = window.location.origin;
        this.appId = '';
        this.jwtHelper = new JwtHelperService();
    }
    /**
     * Retrieves raw token from local storage
     * @return {?}
     */
    getToken() {
        if (isDevMode()) {
            return localStorage.getItem("senwes_token_dev");
        }
        return localStorage.getItem("senwes_token");
    }
    /**
     * Retrieves decoded token from local storage
     * @return {?}
     */
    getDecodedToken() {
        if (isDevMode()) {
            return this.jwtHelper.decodeToken(localStorage.getItem("senwes_token_dev"));
        }
        return this.jwtHelper.decodeToken(localStorage.getItem("senwes_token"));
    }
    /**
     * Confirms validity of token
     * @param {?} appId
     * @param {?=} customDevToken
     * @return {?}
     */
    authenticateToken(appId, customDevToken = null) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return new Promise((/**
             * @param {?} resolve
             * @param {?} reject
             * @return {?}
             */
            (resolve, reject) => {
                if (isDevMode()) {
                    localStorage.removeItem('senwes_token_dev');
                    if (customDevToken != null) {
                        localStorage.setItem('senwes_token_dev', customDevToken);
                    }
                    else {
                        localStorage.setItem('senwes_token_dev', senwes_dev_token);
                    }
                    resolve(true);
                    this.initializeUser();
                }
                else {
                    this.appId = appId;
                    /** @type {?} */
                    let url = '';
                    if (this.base_url.indexOf("online-qa.senwes.co.za") > -1 || this.base_url.indexOf("online-qa.hinterland.co.za") > -1 || this.base_url.indexOf("online-qa.my-intranet.co.za") > -1) {
                        url = `https://wsstaging.senwes.co.za/api/oneagri/security/api/Authentication/Validate/Token`;
                    }
                    else {
                        url = `https://ws.senwes.co.za/service/oneagri/security/api/Authentication/Validate/Token`;
                    }
                    /** @type {?} */
                    const headers = new HttpHeaders({
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.getLocalToken()}`
                    });
                    this._http.get(url, { headers: headers })
                        .pipe(take(1))
                        .subscribe((/**
                     * @param {?} res
                     * @return {?}
                     */
                    (res) => {
                        if (res === false) {
                            localStorage.removeItem('senwes_token');
                            this.redirectJWTIssuerPage(appId);
                            resolve(false);
                        }
                        else if (res === true) {
                            resolve(true);
                            this.initializeUser();
                        }
                        else {
                            resolve(false);
                            console.error('Unxpected response validate token: ', res);
                            this.redirectAccessDenied();
                        }
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    error => {
                        reject(false);
                        console.error("AuthService unexpected error occurred", error);
                        this.redirectAccessDenied();
                    }));
                }
            }));
        });
    }
    /**
     * @private
     * @return {?}
     */
    getLocalToken() {
        /** @type {?} */
        let token = '';
        if (isDevMode()) {
            token = localStorage.getItem("senwes_token_dev");
        }
        else {
            token = localStorage.getItem("senwes_token");
        }
        return token;
    }
    /**
     * @private
     * @param {?} returnURL
     * @return {?}
     */
    redirectJWTIssuerPage(returnURL) {
        if (this.base_url.indexOf("online-qa.senwes.co.za") > -1 || this.base_url.indexOf("online-qa.hinterland.co.za") > -1 || this.base_url.indexOf("online-qa.my-intranet.co.za") > -1) {
            window.location.href = `https://integration-qa.senwes.co.za/service/security/oneagri/auth/authentication?ApplicationID=${this.appId}`;
        }
        else {
            window.location.href = `https://identity.oneagri.co.za/authentication?ApplicationID=${this.appId}`;
        }
    }
    /**
     * @return {?}
     */
    signout() {
        localStorage.removeItem('senwes_token');
        localStorage.removeItem('senwes_token_dev');
        if (isDevMode()) {
            window.location.reload;
        }
        else {
            if (this.base_url.indexOf("online-qa.senwes.co.za") > -1 || this.base_url.indexOf("online-qa.hinterland.co.za") > -1 || this.base_url.indexOf("online-qa.my-intranet.co.za") > -1) {
                window.location.href = `https://integration-qa.senwes.co.za/service/security/oneagri/auth/signout`;
            }
            else {
                window.location.href = `https://identity.oneagri.co.za/signout`;
            }
        }
    }
    /**
     * @return {?}
     */
    home() {
        if (isDevMode()) {
            window.location.reload;
        }
        else {
            window.location.href = this.base_url;
        }
    }
    /**
     * @private
     * @return {?}
     */
    redirectAccessDenied() {
        window.location.href = `http://www.oneagri.co.za/auth/accessdenied/`;
    }
    /**
     * @return {?}
     */
    getUserRoles() {
        if (this._user) {
            return this._user.role;
        }
    }
    /**
     * @param {?} roleName
     * @return {?}
     */
    isUserInRole(roleName) {
        if (this._user) {
            if (Array.isArray(this._user.role)) {
                /** @type {?} */
                const res = this._user.role.findIndex((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => x == roleName));
                return (res !== -1);
            }
            else {
                return (roleName === this._user.role);
            }
        }
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getUserPermissionsBySystemName(filter) {
        if (this._user) {
            if (Array.isArray(this._user.permissions)) {
                /** @type {?} */
                const res = this._user.permissions.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => x.SystemName == filter));
                return res;
            }
        }
    }
    /**
     * @param {?} permissionGroup
     * @param {?} permissionName
     * @return {?}
     */
    hasPermission(permissionGroup, permissionName) {
        if (this._user) {
            if (Array.isArray(this._user.permissions)) {
                /** @type {?} */
                const res = this._user.permissions.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => x.PermissionGroup == permissionGroup && x.PermissionName == permissionName));
                return res.length > 0;
            }
        }
    }
    /**
     * @return {?}
     */
    getRawUserObject() {
        return this._user;
    }
    /**
     * @return {?}
     */
    getUserWindowsClaim() {
        if (this._user) {
            return this._user.windowsuserclaim;
        }
    }
    /**
     * @return {?}
     */
    getUserCompany() {
        if (this._user.employee) {
            return this._user.employee.company;
        }
    }
    /**
     * @return {?}
     */
    getUserDivision() {
        if (this._user.employee) {
            return this._user.employee.division;
        }
    }
    /**
     * @return {?}
     */
    getUserSection() {
        if (this._user.employee) {
            return this._user.employee.section;
        }
    }
    /**
     * @return {?}
     */
    getUserJobTitle() {
        if (this._user.employee) {
            return this._user.employee.jobtitle;
        }
    }
    /**
     * @return {?}
     */
    getUserEmpObfuscation() {
        if (this._user.employee) {
            return this._user.employee.employeeobfuscation;
        }
    }
    /**
     * @return {?}
     */
    getUserSite() {
        if (this._user.employee) {
            return this._user.employee.site;
        }
    }
    /**
     * @return {?}
     */
    getUserReportsTo() {
        if (this._user.employee) {
            return this._user.employee.reportsTo;
        }
    }
    /**
     * @return {?}
     */
    getUserDepartment() {
        if (this._user.employee) {
            return this._user.employee.department;
        }
    }
    /**
     * @return {?}
     */
    getUserEmployeeNumber() {
        if (this._user) {
            return this._user.employeeNo;
        }
    }
    /**
     * @return {?}
     */
    getUserOneId() {
        if (this._user) {
            return this._user.oneid;
        }
    }
    /**
     * @return {?}
     */
    getUserDisplayName() {
        if (this._user) {
            return `${this._user.given_name} ${this._user.family_name}`;
        }
    }
    /**
     * @return {?}
     */
    getUserEmployeeInfo() {
        if (this._user) {
            return this._user.employee;
        }
    }
    /**
     * @return {?}
     */
    getTokenExpired() {
        this._user = this.jwtHelper.decodeToken(this.getToken());
        if (this._user) {
            return this._user.exp < Math.floor(Date.now() / 1000);
        }
    }
    /**
     * @return {?}
     */
    initializeUser() {
        this._user = this.jwtHelper.decodeToken(this.getToken());
        if (typeof this._user.role !== 'undefined' && !Array.isArray(this._user.role)) {
            this._user.role = [this._user.role];
        }
        if (typeof this._user.permissions !== 'undefined' && !Array.isArray(this._user.permissions)) {
            this._user.permissions = [this._user.permissions];
        }
    }
}
SenwesAuthorizationService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
/** @nocollapse */
SenwesAuthorizationService.ctorParameters = () => [
    { type: HttpClient }
];
/** @nocollapse */ SenwesAuthorizationService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function SenwesAuthorizationService_Factory() { return new SenwesAuthorizationService(i0.ɵɵinject(i1.HttpClient)); }, token: SenwesAuthorizationService, providedIn: "root" });
if (false) {
    /** @type {?} */
    SenwesAuthorizationService.prototype.base_url;
    /** @type {?} */
    SenwesAuthorizationService.prototype.appId;
    /**
     * @type {?}
     * @private
     */
    SenwesAuthorizationService.prototype._user;
    /** @type {?} */
    SenwesAuthorizationService.prototype.jwtHelper;
    /**
     * @type {?}
     * @private
     */
    SenwesAuthorizationService.prototype._http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Vud2VzLWF1dGhvcml6YXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzZW53ZXMvc2Vud2VzLWF1dGhvcml6YXRpb24vIiwic291cmNlcyI6WyJsaWIvc2Vud2VzLWF1dGhvcml6YXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0RCxPQUFPLEVBQWEsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRS9ELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7O0FBT3RELE1BQU0sT0FBTywwQkFBMEI7Ozs7SUFPckMsWUFDVSxLQUFpQjtRQUFqQixVQUFLLEdBQUwsS0FBSyxDQUFZO1FBUHBCLGFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUNsQyxVQUFLLEdBQVcsRUFBRSxDQUFDO1FBR25CLGNBQVMsR0FBRyxJQUFJLGdCQUFnQixFQUFFLENBQUM7SUFJdEMsQ0FBQzs7Ozs7SUFLRSxRQUFRO1FBQ2IsSUFBSSxTQUFTLEVBQUUsRUFBRTtZQUNmLE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQ2pEO1FBQ0QsT0FBTyxZQUFZLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzlDLENBQUM7Ozs7O0lBS00sZUFBZTtRQUNwQixJQUFJLFNBQVMsRUFBRSxFQUFFO1lBQ2pCLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7U0FDM0U7UUFDRCxPQUFPLElB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QUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEVBQUU7WUFDM0YsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ25EO0lBQ0gsQ0FBQzs7O1lBM1FGLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7OztZQVRRLFVBQVU7Ozs7O0lBV2pCLDhDQUF5Qzs7SUFDekMsMkNBQTBCOzs7OztJQUMxQiwyQ0FBcUI7O0lBRXJCLCtDQUEwQzs7Ozs7SUFHeEMsMkNBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgaXNEZXZNb2RlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEp3dE1vZHVsZSwgSnd0SGVscGVyU2VydmljZSB9IGZyb20gJ0BhdXRoMC9hbmd1bGFyLWp3dCc7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJVXNlciB9IGZyb20gJy4vdXNlci5tb2RlbCc7XHJcbmltcG9ydCB7IHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IHNlbndlc19kZXZfdG9rZW4gfSBmcm9tICcuL3Nlbndlc190b2tlbl9kZXYnO1xyXG5pbXBvcnQgeyBJRW1wbG95ZWUgfSBmcm9tICcuL2VtcGxveWVlLm1vZGVsJztcclxuaW1wb3J0IHsgSVBlcm1pc3Npb24gfSBmcm9tICcuL3Blcm1pc3Npb24ubW9kZWwnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIFNlbndlc0F1dGhvcml6YXRpb25TZXJ2aWNlIHtcclxuICBwdWJsaWMgYmFzZV91cmwgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luO1xyXG4gIHB1YmxpYyBhcHBJZDogc3RyaW5nID0gJyc7XHJcbiAgcHJpdmF0ZSBfdXNlcjogSVVzZXI7XHJcblxyXG4gIHB1YmxpYyBqd3RIZWxwZXIgPSBuZXcgSnd0SGVscGVyU2VydmljZSgpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgX2h0dHA6IEh0dHBDbGllbnQsXHJcbiAgKSB7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0cmlldmVzIHJhdyB0b2tlbiBmcm9tIGxvY2FsIHN0b3JhZ2VcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0VG9rZW4oKTogc3RyaW5nIHtcclxuICAgIGlmIChpc0Rldk1vZGUoKSkge1xyXG4gICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzZW53ZXNfdG9rZW5fZGV2XCIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic2Vud2VzX3Rva2VuXCIpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0cmlldmVzIGRlY29kZWQgdG9rZW4gZnJvbSBsb2NhbCBzdG9yYWdlXHJcbiAgICovXHJcbiAgcHVibGljIGdldERlY29kZWRUb2tlbigpOiBhbnkge1xyXG4gICAgaWYgKGlzRGV2TW9kZSgpKSB7XHJcbiAgICByZXR1cm4gdGhpcy5qd3RIZWxwZXIuZGVjb2RlVG9rZW4obG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzZW53ZXNfdG9rZW5fZGV2XCIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmp3dEhlbHBlci5kZWNvZGVUb2tlbihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInNlbndlc190b2tlblwiKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb25maXJtcyB2YWxpZGl0eSBvZiB0b2tlblxyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyBhdXRoZW50aWNhdGVUb2tlbihhcHBJZDogc3RyaW5nLCBjdXN0b21EZXZUb2tlbjogc3RyaW5nID0gbnVsbCk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XHJcbiAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnc2Vud2VzX3Rva2VuX2RldicpO1xyXG5cclxuICAgICAgICAgIGlmIChjdXN0b21EZXZUb2tlbiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzZW53ZXNfdG9rZW5fZGV2JywgY3VzdG9tRGV2VG9rZW4pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Nlbndlc190b2tlbl9kZXYnLCBzZW53ZXNfZGV2X3Rva2VuKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgdGhpcy5pbml0aWFsaXplVXNlcigpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmFwcElkID0gYXBwSWQ7XHJcbiAgICAgICAgICBsZXQgdXJsID0gJyc7XHJcbiAgICAgICAgICBpZiAodGhpcy5iYXNlX3VybC5pbmRleE9mKFwib25saW5lLXFhLnNlbndlcy5jby56YVwiKSA+IC0xIHx8IHRoaXMuYmFzZV91cmwuaW5kZXhPZihcIm9ubGluZS1xYS5oaW50ZXJsYW5kLmNvLnphXCIpID4gLTEgfHwgdGhpcy5iYXNlX3VybC5pbmRleE9mKFwib25saW5lLXFhLm15LWludHJhbmV0LmNvLnphXCIpID4gLTEpIHtcclxuICAgICAgICAgICAgdXJsID0gYGh0dHBzOi8vd3NzdGFnaW5nLnNlbndlcy5jby56YS9hcGkvb25lYWdyaS9zZWN1cml0eS9hcGkvQXV0aGVudGljYXRpb24vVmFsaWRhdGUvVG9rZW5gO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdXJsID0gYGh0dHBzOi8vd3Muc2Vud2VzLmNvLnphL3NlcnZpY2Uvb25lYWdyaS9zZWN1cml0eS9hcGkvQXV0aGVudGljYXRpb24vVmFsaWRhdGUvVG9rZW5gO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoe1xyXG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLmdldExvY2FsVG9rZW4oKX1gXHJcbiAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgIHRoaXMuX2h0dHAuZ2V0PGJvb2xlYW4+KHVybCwgeyBoZWFkZXJzOiBoZWFkZXJzIH0pXHJcbiAgICAgICAgICAgIC5waXBlKHRha2UoMSkpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnc2Vud2VzX3Rva2VuJyk7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMucmVkaXJlY3RKV1RJc3N1ZXJQYWdlKGFwcElkKTtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxpemVVc2VyKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVW54cGVjdGVkIHJlc3BvbnNlIHZhbGlkYXRlIHRva2VuOiAnLCByZXMpO1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnJlZGlyZWN0QWNjZXNzRGVuaWVkKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkF1dGhTZXJ2aWNlIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWRcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWRpcmVjdEFjY2Vzc0RlbmllZCgpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRMb2NhbFRva2VuKCk6IHN0cmluZyB7XHJcbiAgICBsZXQgdG9rZW4gPSAnJztcclxuICAgIGlmIChpc0Rldk1vZGUoKSkge1xyXG4gICAgICB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic2Vud2VzX3Rva2VuX2RldlwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzZW53ZXNfdG9rZW5cIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG9rZW47XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlZGlyZWN0SldUSXNzdWVyUGFnZShyZXR1cm5VUkw6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuYmFzZV91cmwuaW5kZXhPZihcIm9ubGluZS1xYS5zZW53ZXMuY28uemFcIikgPiAtMSB8fCB0aGlzLmJhc2VfdXJsLmluZGV4T2YoXCJvbmxpbmUtcWEuaGludGVybGFuZC5jby56YVwiKSA+IC0xIHx8IHRoaXMuYmFzZV91cmwuaW5kZXhPZihcIm9ubGluZS1xYS5teS1pbnRyYW5ldC5jby56YVwiKSA+IC0xKSB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYGh0dHBzOi8vaW50ZWdyYXRpb24tcWEuc2Vud2VzLmNvLnphL3NlcnZpY2Uvc2VjdXJpdHkvb25lYWdyaS9hdXRoL2F1dGhlbnRpY2F0aW9uP0FwcGxpY2F0aW9uSUQ9JHt0aGlzLmFwcElkfWA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGBodHRwczovL2lkZW50aXR5Lm9uZWFncmkuY28uemEvYXV0aGVudGljYXRpb24/QXBwbGljYXRpb25JRD0ke3RoaXMuYXBwSWR9YDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzaWdub3V0KCkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3Nlbndlc190b2tlbicpO1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3Nlbndlc190b2tlbl9kZXYnKTtcclxuICAgIGlmIChpc0Rldk1vZGUoKSkge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHRoaXMuYmFzZV91cmwuaW5kZXhPZihcIm9ubGluZS1xYS5zZW53ZXMuY28uemFcIikgPiAtMSB8fCB0aGlzLmJhc2VfdXJsLmluZGV4T2YoXCJvbmxpbmUtcWEuaGludGVybGFuZC5jby56YVwiKSA+IC0xIHx8IHRoaXMuYmFzZV91cmwuaW5kZXhPZihcIm9ubGluZS1xYS5teS1pbnRyYW5ldC5jby56YVwiKSA+IC0xKSB7XHJcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgaHR0cHM6Ly9pbnRlZ3JhdGlvbi1xYS5zZW53ZXMuY28uemEvc2VydmljZS9zZWN1cml0eS9vbmVhZ3JpL2F1dGgvc2lnbm91dGA7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgaHR0cHM6Ly9pZGVudGl0eS5vbmVhZ3JpLmNvLnphL3NpZ25vdXRgO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaG9tZSgpIHtcclxuICAgIGlmIChpc0Rldk1vZGUoKSkge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB0aGlzLmJhc2VfdXJsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWRpcmVjdEFjY2Vzc0RlbmllZCgpIHtcclxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYGh0dHA6Ly93d3cub25lYWdyaS5jby56YS9hdXRoL2FjY2Vzc2RlbmllZC9gO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJSb2xlcygpOiBBcnJheTxzdHJpbmc+IHtcclxuICAgIGlmICh0aGlzLl91c2VyKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLnJvbGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNVc2VySW5Sb2xlKHJvbGVOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLl91c2VyKSB7XHJcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuX3VzZXIucm9sZSkpIHtcclxuICAgICAgICBjb25zdCByZXMgPSB0aGlzLl91c2VyLnJvbGUuZmluZEluZGV4KHggPT4geCA9PSByb2xlTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIChyZXMgIT09IC0xKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gKHJvbGVOYW1lID09PSB0aGlzLl91c2VyLnJvbGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlclBlcm1pc3Npb25zQnlTeXN0ZW1OYW1lKGZpbHRlcjogc3RyaW5nKTogSVBlcm1pc3Npb25bXSB7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLl91c2VyLnBlcm1pc3Npb25zKSkge1xyXG4gICAgICAgIGNvbnN0IHJlcyA9IHRoaXMuX3VzZXIucGVybWlzc2lvbnMuZmlsdGVyKHggPT4geC5TeXN0ZW1OYW1lID09IGZpbHRlcik7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGhhc1Blcm1pc3Npb24ocGVybWlzc2lvbkdyb3VwOiBzdHJpbmcsIHBlcm1pc3Npb25OYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLl91c2VyKSB7XHJcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuX3VzZXIucGVybWlzc2lvbnMpKSB7XHJcbiAgICAgICAgY29uc3QgcmVzID0gdGhpcy5fdXNlci5wZXJtaXNzaW9ucy5maWx0ZXIoeCA9PiB4LlBlcm1pc3Npb25Hcm91cCA9PSBwZXJtaXNzaW9uR3JvdXAgJiYgeC5QZXJtaXNzaW9uTmFtZSA9PSBwZXJtaXNzaW9uTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5sZW5ndGggPiAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0UmF3VXNlck9iamVjdCgpOiBJVXNlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fdXNlcjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyV2luZG93c0NsYWltKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci53aW5kb3dzdXNlcmNsYWltO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJDb21wYW55KCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlci5lbXBsb3llZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5lbXBsb3llZS5jb21wYW55O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJEaXZpc2lvbigpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIuZW1wbG95ZWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIuZW1wbG95ZWUuZGl2aXNpb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlclNlY3Rpb24oKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyLmVtcGxveWVlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLmVtcGxveWVlLnNlY3Rpb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlckpvYlRpdGxlKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlci5lbXBsb3llZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5lbXBsb3llZS5qb2J0aXRsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyRW1wT2JmdXNjYXRpb24oKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyLmVtcGxveWVlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLmVtcGxveWVlLmVtcGxveWVlb2JmdXNjYXRpb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlclNpdGUoKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyLmVtcGxveWVlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLmVtcGxveWVlLnNpdGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlclJlcG9ydHNUbygpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIuZW1wbG95ZWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIuZW1wbG95ZWUucmVwb3J0c1RvO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJEZXBhcnRtZW50KCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5fdXNlci5lbXBsb3llZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5lbXBsb3llZS5kZXBhcnRtZW50O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJFbXBsb3llZU51bWJlcigpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3VzZXIuZW1wbG95ZWVObztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyT25lSWQoKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLl91c2VyKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLm9uZWlkO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJEaXNwbGF5TmFtZSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3VzZXIpIHtcclxuICAgICAgcmV0dXJuIGAke3RoaXMuX3VzZXIuZ2l2ZW5fbmFtZX0gJHt0aGlzLl91c2VyLmZhbWlseV9uYW1lfWBcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRVc2VyRW1wbG95ZWVJbmZvKCk6IElFbXBsb3llZSB7XHJcbiAgICBpZiAodGhpcy5fdXNlcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5fdXNlci5lbXBsb3llZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRUb2tlbkV4cGlyZWQoKTogYm9vbGVhbiB7XHJcbiAgICB0aGlzLl91c2VyID0gdGhpcy5qd3RIZWxwZXIuZGVjb2RlVG9rZW4odGhpcy5nZXRUb2tlbigpKTtcclxuICAgIGlmICh0aGlzLl91c2VyKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl91c2VyLmV4cCA8IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGluaXRpYWxpemVVc2VyKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fdXNlciA9IHRoaXMuand0SGVscGVyLmRlY29kZVRva2VuKHRoaXMuZ2V0VG9rZW4oKSk7XHJcbiAgICBpZiAodHlwZW9mIHRoaXMuX3VzZXIucm9sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgIUFycmF5LmlzQXJyYXkodGhpcy5fdXNlci5yb2xlKSkge1xyXG4gICAgICB0aGlzLl91c2VyLnJvbGUgPSBbdGhpcy5fdXNlci5yb2xlXTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIHRoaXMuX3VzZXIucGVybWlzc2lvbnMgIT09ICd1bmRlZmluZWQnICYmICFBcnJheS5pc0FycmF5KHRoaXMuX3VzZXIucGVybWlzc2lvbnMpKSB7XHJcbiAgICAgIHRoaXMuX3VzZXIucGVybWlzc2lvbnMgPSBbdGhpcy5fdXNlci5wZXJtaXNzaW9uc107XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==