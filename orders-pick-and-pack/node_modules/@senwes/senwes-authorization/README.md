# Senwes Authorization Service

Senwes authorization service for JWT handling and user information

## Installation

Use npm to install SenwesAuthorization.

```bash
npm install @senwes/senwes-authorization
```

## Usage

```typescript
import { SenwesAuthorizationService } from '@senwes/senwes-authorization';

constructor(private _authService: SenwesAuthorizationService) { }

ngOnInit(): void {
  const appId: string = environment.appId;
  const isAuthenticated = from(this._authService.authenticateToken(appId));
  isAuthenticated.subscribe((res: boolean) => { console.log(res) })
}
```

## Methods

####authenticateToken

Handles authentication and authorization of JWT token. Redirects to intermediary page for token issueing and redirects back to app using url linked to the pagekey. If user is unauthorized redirects to unauthorized access page.

| Parameter      |   Type   |                                                                    Description |
| -------------- | :------: | -----------------------------------------------------------------------------: |
| appId          | `string` |                              The generated app id for the specific application |
| customDevToken | `string` | Optional parameter for custom dev token - Use JWT.IO to create your test token |

Returns `void`

---

####initializeUser

Sets \_user object call after authenticateToken

Returns `void`

####getToken

Retrieves the JWT token from local storage

Returns `string`

---

####getUserRoles

Retrieves all user roles assigned to logged in user

Returns `string[]`

---

####isUserInRole

Tests if logged in user is in provided role

| Parameter |   Type   | Description |
| --------- | :------: | ----------: |
| roleName  | `string` |   Role name |

Returns `boolean`

---

####getUserWindowsClaim

Retrieves logged in user's AD account name ex. `jacor`

Returns `string`

---

####getUserEmployeeNumber

Retrieves logged in user's employee number ex. `66999`

Returns `string`

---

####getUserOneId

Retrieves logged in user's one id ex. `999`

Returns `string`

---

####getUserDisplayName

Retrieves logged in user's name and surname. `Jaco Roux`

Returns `string`

####getUserCompany

Retrieves logged in user's company code. `050`

Returns `string`

####getUserDepartment

Retrieves logged in user's department code. `IT`

Returns `string`

####getUserDivision

Retrieves logged in user's division code. `FI`

Returns `string`

####getUserSection

Retrieves logged in user's site code. `F65`

Returns `string`

####getUserSite

Retrieves logged in user's site code. `R302`

Returns `string`

####getUserEmpObfuscation

Retrieves logged in user's obfuscated employee number

Returns `string`

####getUserJobTitle

Retrieves logged in user's job title

Returns `string`

####getUserReportsTo

Retrieves logged in user's reportsTo employee number.

Returns `string`

####getUserEmployeeInfo

Retrieves logged in user's employee object (structure and reportsTo).

Returns `IEmployee`

####getUserPermissionsBySystemName

Retrieves all permission groups by system name

Returns `IPermission[]`

#### getTokenExpired

Returns true if token expired

Returns `boolean`

#### getDecodedToken

Retrieves decoded token from local storage

## Contributing

Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.

## Build

Run `ng build senwes-authorization` to build the project. The build artifacts will be stored in the `dist/` directory.

## Publishing

After building your library with `ng build senwes-authorization`, go to the dist folder `cd dist/senwes-authorization` and run `npm publish`.
